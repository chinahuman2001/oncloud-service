const cds = require('../../cds')

// REVISIT: compiler to provide API for smart quoting (not just list)
// require list from compiler
const _COMPILER_RESERVED = {}
try {
  const keywords = require('@sap/cds-compiler/lib/base/keywords')
  _COMPILER_RESERVED.hana = keywords.hana
  _COMPILER_RESERVED.sqlite = keywords.sqlite
} catch (e) {
  // ignore
}

// fallback
const _DEFAULT_RESERVED = {
  WHERE: 1,
  GROUP: 1,
  ORDER: 1,
  BY: 1,
  AT: 1,
  NO: 1,
  LIMIT: 1
  // ...
}

const _slugify = name => name.replace(/\./g, '_')

module.exports = {
  quoted: name => `"${name}"`,
  plain: name => {
    const upper = name.toUpperCase()
    const RESERVED = (cds.db && _COMPILER_RESERVED[cds.db.kind]) || _DEFAULT_RESERVED
    return upper in RESERVED ? `"${upper}"` : _slugify(name)
  },
  'all-upper': name => `"${_slugify(name.toUpperCase())}"`,
  'all-lower': name => `"${_slugify(name.toLowerCase())}"`,
  bracketed: name => `[${name}]`
}
